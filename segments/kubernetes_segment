#!/usr/bin/env bash

# kubernetes_segment

# -----------------------------------------------------------------------------
# append to prompt: default kubernetes context/namespace from $KUBECONFIG
# arg: $1 primary color
# arg: $2 secondary color
function kubernetes_segment {
    command -v kubectl &> /dev/null  || return # exit early if no kubectl

    local primary_color=$1
    local secondary_color=$2
    local context
    context=$(kubectl config current-context)
    if [[ -n ${context} ]]; then
        local ns
        ns=$( kubectl config view -o jsonpath="{.contexts[?(@.name == \"${context}\")].context.namespace}"  )
        if [[ -n ${ns} ]]; then
            local kubesymbol=$'\xE2\x8E\x88'
            local content="${kubesymbol} ${context}:${ns}"
            add_segment "${content}" "${primary_color}" "${secondary_color}"
        fi
    fi
}
